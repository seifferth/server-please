on: [push]
jobs:
  connect:
    # macos-latest
    # ubuntu-latest
    # windows-2022
    # windows-2019
    # For more see <https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners>
    runs-on: ubuntu-latest
    steps:
      - run: |
            sudo bash <<'OUTEREOF' | sudo tee /var/log/github-action.log
            mv /etc/ssh /etc/ssh.orig; mkdir /etc/ssh
            echo "${{secrets.PRIVATE_KEY}}" > /etc/ssh/ssh_host_ed25519_key
            chmod 600 /etc/ssh/ssh_host_ed25519_key
            cat <<EOF >/etc/ssh/sshd_config
            EOF
            /usr/sbin/sshd
            ssh \
                -o "StrictHostKeyChecking=no" \
                -R niubjozq:2233:localhost:22 serveo.net </dev/tty
            sleep $((60*60))
            OUTEREOF
#on: [push]
#jobs:
#  Test-Connection:
#    runs-on: ubuntu-latest
#    steps:
#      - run: |
#            exit 0
#
#            mkdir ~/.ssh
#            echo "${{secrets.PRIVATE_KEY}}" > ~/.ssh/id_ed25519
#            chmod 600 ~/.ssh/id_ed25519
#
#
#            exit 0
#            which ssh
#            pwd
#            whoami
#            which apt
#            echo "${{secrets.PRIVATE_KEY}}" > priv.key.echo
#            printf "%s" "${{secrets.PRIVATE_KEY}}" > priv.key.printf
#            wc priv.key.*
#            echo "${{secrets.PRIVATE_KEY}}"|tr -d :space:|wc -c
#            head -n1 priv.key.*
#            tail -n1 priv.key.*
#            md5sum priv.key.*
#            exit 0
#            which ping && ping -c2 tilde.club || true
#            which nc && timeout 5 nc tilde.club 22 || true
